<!DOCTYPE html>
<html lang="sv-SE" class="no-js no-svg">
<head>
<meta charset="UTF-8">
<script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
<style>
    
    .table td {padding:0; border:0;}
    .table-sm td {padding:0.1em; width:3em;}
    p.btn {width:3em;}
    .center {        
        position: absolute;
        left: 50%;
        margin-right: -50%;
        transform: translate(-50%, 0)       
        }

</style>
</head>
<body>
    <div class="container"> 
            <div id="demo"></div>
            <div class="p-3 center">
                <div >
                    <button type="button" id="formerMonth" class="btn btn-info" style="width:49.3%;">&larr; Previous Month</button> <button type="button" id="nextMonth" class="btn btn-info" style="width:49.3%;">Next Month &rarr;</button>
                </div>            
                <div id="calendarContainer" ></div>
            </div>
    </div>

<script>

   /*
Name: The Bookmaker
Developer: Steffo Dimfelt, 2018
Mail: steffo.dimfelt@gmail.com
Sluggo The Bookmaker uses jQuery and ECMA 6
*/

//Setup for global bookingDates and global Check in and Check out.
let checkIn, checkOut;
let bookingDates =[];

class dayButtons {
    constructor(day){
    this._day = day;
    }
    get day(){
        return this._day;
    }
    set day(dayValue){
        this._day = dayValue;
     //   console.log(_day);
    }

}//END: class Buttons

class monthConvert{
    constructor(month){
        this._month = month;
    }
    get month()
    {
        //Array of names
        let monthOut = ["Januari", "Februari", "Mars", "April", "Maj", "Juni", "Juli", "Augusti", "September", "Oktober", "November", "December"];
        return monthOut[this._month];
    }
    set month(monthValue)
    {
        this._month = monthValue;
    }
}

//Return days of single month
function getdaysInThisMonth(m, y) {
 return new Date(y, m+1, 0).getDate();
}

//Headfunction with basic data
function mappingTwoMonths(addToMonth)
{
//Basic data 
let date = new Date();
let currentDay = date.getDate();
let startMonth = date.getMonth();

//Setup name of months
date.setMonth(date.getMonth()+addToMonth);
let currentMonth = date.getMonth();
let nextMonth = currentMonth+1;
    nextMonth==12&&(nextMonth=0)
//Name the months
let printCurrentMonth = new monthConvert(currentMonth);
let printNextMonth = new monthConvert(nextMonth);

//Setup year format
let currentYear = date.getFullYear();
let nextYear;
nextMonth==0 ? nextYear=currentYear+1:nextYear=currentYear;

//Setup buttons of months
let daysOfCurrentMonth = getdaysInThisMonth (currentMonth, currentYear);
let daysOfNextMonth = getdaysInThisMonth (nextMonth, nextYear);
let firstDayCurrentMonth = new Date(currentYear, currentMonth, 1);
let firstDayNextMonth = new Date(nextYear, nextMonth, 1);

//  console.log("nextYear "+nextYear)
// console.log("nextMonth "+nextMonth)
// console.log("firstDayNextMonth "+firstDayNextMonth)


 //console.log("printCurrentMonth "+printCurrentMonth.month)
// console.log("printNextMonth "+printNextMonth.month)

//  let allOut="";
// allOut += "Detta år:"+date+"<br>";
 //allOut += "Denna månad nr:"+currentMonth+"<br>";
//     allOut += "Nästa månad nr:"+nextMonth+"<br>";
// allOut += "Dagar Denna månad:"+ daysOfCurrentMonth +"<br>";
// allOut += "Dagar nästa månad:"+ daysOfNextMonth +"<br>";
// allOut += "Första dagen denna månad "+ firstDayCurrentMonth +"<br>";
// allOut += "Första dagen denna månad "+ firstDayCurrentMonth.getDay() +"<br>";
// allOut += "Första dagen nästa månad "+ firstDayNextMonth +"<br>";
// allOut += "Första dagen nästa månad "+ firstDayNextMonth.getDay() +"<br>";
//  document.getElementById("demo").innerHTML = allOut;

let makeTheBookmaker="";
makeTheBookmaker += "<div>"+currentYear+": "+printCurrentMonth.month+"</div>";
makeTheBookmaker += CalendarMapping(daysOfCurrentMonth,firstDayCurrentMonth.getDay(),currentDay,currentMonth,currentYear,startMonth);
makeTheBookmaker += "<div>"+nextYear+": "+printNextMonth.month+"</div>";
makeTheBookmaker += CalendarMapping(daysOfNextMonth,firstDayNextMonth.getDay(),currentDay,nextMonth,nextYear,startMonth);

$("#calendarContainer").html(makeTheBookmaker);


}//END: mappingTwoMonths

function CalendarMapping(daysInThisMonth,firstDay,currentDay,currentMonth,currentYear,startMonth)
{
if (currentMonth<=9){currentMonth="0"+currentMonth} 

// Mapping calendar
let ii =1;
let calendarMapping = "<table class='table table-sm m-0' >";

//Mapping empty days at beginning of month
let emptyStartDays="";
function mapTD(tdVal){for (x=1;x<tdVal;x++)emptyStartDays+="<td></td>";}

firstDay == 0 ? ii=7 : ii=firstDay;
mapTD(ii);

//Loop through calendardays
for (i=1;i<=daysInThisMonth;i++) 
{
  let thisDay = new dayButtons(i);
    //console.log("ii "+ii)
    if (ii==1){ calendarMapping += "<tr >";}
        if (emptyStartDays!=""){calendarMapping+=emptyStartDays;emptyStartDays=""}
     
            if (thisDay.day<currentDay&&currentMonth==startMonth)
            {
                if (thisDay.day<=9){thisDay.day="0"+thisDay.day} 
                calendarMapping += "<td style='text-align:center; width:14.2857142857%;' ><button  type='button' class='btn btn-primary m-0 disabled' style=' width:100%;' >"+thisDay.day+"</button></td>";
            }else{
                if (thisDay.day<=9){thisDay.day="0"+thisDay.day} 
                calendarMapping += "<td style='text-align:center; width:14.2857142857%;' ><button id='"+currentYear+currentMonth+thisDay.day+"' type='button' class='bookie-btn btn btn-primary m-0' style=' width:100%;' >"+thisDay.day+"</button></td>";
            } 
    if (ii>=7){ calendarMapping += "</tr>";}
    if (ii<=6){ii++;}else{ii=1;}   
}
calendarMapping += "</table>";

return calendarMapping;
}//END: Function CalendarMapping

function reservations (bookingDate)
{
    console.log("bookingDates "+bookingDates)
console.log("bookingDate "+bookingDate)
// console.log("checkIn före"+checkIn)
// bookingDate<= checkIn ? console.log("Mindre"):console.log("större");

// if (bookingDate<=checkIn&&bookingDate<checkOut)
// {
//     console.log("mindre än checkin")
//     console.log("mindre än checkout")
// }
// if (bookingDate>checkIn&&bookingDate>checkOut)
// {
//     console.log("större än checkin")
//     console.log("större än checkout")
// }

//Local function to evaluate day out of button id
function dayDetection(dateToEval)
{
    dateToEval = dateToEval.slice(-2);
    console.log("dateToEval "+dateToEval)
}


if (bookingDate>checkIn&&bookingDate<=checkOut)
{
    // console.log("bookingDate "+bookingDate)
    // console.log("större än checkin")
    // console.log("mindre än eller lika med checkout")

    checkOut = bookingDate;
    bookingDates=[];
    $(".bookie-btn").removeClass( "bg-warning" );
    for (checkCount=checkIn;checkCount<=checkOut;checkCount++)
    {

        let getDayOut = checkCount.toString().slice(-2)
        getDayOut = parseInt(getDayOut);
        if (getDayOut<=31)
        {
        // console.log("checkCount new "+checkCount)
        $("#"+checkCount).addClass( "bg-warning" );
        bookingDates.push(checkCount)
        }
        console.log("bookingDates "+bookingDates)

        console.log("checkCount "+checkCount)
        console.log("checkIn "+checkIn)
    }


}else{
        //Push till array
        bookingDates.push(bookingDate)

        //sortera array efter minsta valör till högsta
        bookingDates = bookingDates.sort((a, b) => a - b);

        //Ta det lägsta och lägg i en variabel
        checkIn = bookingDates[0];
        // console.log("checkIn "+checkIn)

        //Ta det högsta och lägg i en variabel
        checkOut = bookingDates[bookingDates.length-1];
        // console.log("checkOut "+checkOut)

        //Sätt alla knappar som är class bookie-btn till default
       // $(".bookie-btn").addClass( "bg-secondary" );
       if (checkIn==checkOut)
       {
        $(".bookie-btn").removeClass( "bg-warning" );
       }

        bookingDates=[];
        //Loopa igenom från lägsta och stanna vid högsta
        //Formatera samtidigt knapparna till gult
        for (checkCount=checkIn;checkCount<=checkOut;checkCount++)
        {
            console.log("bookingDate "+bookingDate)
        console.log("checkIn "+checkIn)
            // console.log("checkCount "+checkCount)
            // $("#"+checkCount).addClass( "bg-warning" );
            // bookingDates.push(checkCount)

            let getDayOut = checkCount.toString().slice(-2)
            getDayOut = parseInt(getDayOut);

        if (getDayOut<=31)
        {
        // console.log("checkCount new "+checkCount)
        $("#"+checkCount).addClass( "bg-warning" );
        bookingDates.push(checkCount)
        }
        console.log("bookingDates "+bookingDates)
        }
}




//console.log("bookingDates före "+bookingDates);


//bookingDates=[];






//Nollställ array

// console.log("bookingDates efter "+bookingDates);



    
}

/* Körschema
1. Gör en funktion som mappar upp en månad [CHECK]
2. Använd den funktion för att köra två månader. [CHECK]
3. De två månaderna ska läggas in i div [CHECK]
4. Ta reda på nummer på första dagen i denna månad, för att kunna veta vilken dag nästa börjar på [CHECK]
5. Fånga upp sista dagen i första månaden [CHECK]
6.  0 om första dagen i nästa månad är en söndag [CHEKC]
7. Mappa upp två månader efter varandra [CHECK]
8. Fel när man byter månader. Dagarna synkar inte. [CHECK]
9. Månadstalet måste ändras när man går över årsskifte annars adderas de bara. [CHECK]
10. Åren ändras inte när man går över årskifte [CHECK]
11. Lås dagar som är äldre än "dagens datum" [CHECK]
12. Centrera hela kalendern. [CHECK]
13. Alla knappar är lika breda [CHECK]
14. Registrera val [CHECK]
15. Spara val i en array.  [CHECK]
16. Ändra färg på valen. [CHECK]
17. Gör en function för att hantera val. [CHECK]
18. Gör det möjligt att boka tvärs över månader. [CHECK]
19. Rensa upp dubbelkod som adderar till array och skriver ut nya färger (gula) på knapparna
20. Ändra från gul till blå när man klickar på en ensam knapp. 
*/

$(function(){
let setNewMonth = 0; //Initial add number from current month

mappingTwoMonths(setNewMonth)

$("#formerMonth").click(function(){
   
    setNewMonth<=0? setNewMonth=0: setNewMonth --;
    mappingTwoMonths(setNewMonth)
});
$("#nextMonth").click(function(){
    setNewMonth>=12? setNewMonth=12: setNewMonth ++;//Set max number of months ahed.
    mappingTwoMonths(setNewMonth)
});

//Bookie Button setup
$('.bookie-btn').click(function(){
   reservations ($(this).attr('id'));
 });
})


</script>  

</body>
</html>